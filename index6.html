<script src="https://d3js.org/d3.v4.min.js"></script>
<style>
	.tick{
		font-size: 15pt;
		stroke-width: 4;
	}
	.domain{
		stroke-width: 4;
	}
	#button1{
	  width: 20%;
	  height: 5%;
	  background-color: #4096F2;
	  border-style: none;
	  color: white;
	}
#button2{
  width: 20%;
  height: 5%;
  background-color: #EF3B2E;
  border-style: none;
  color: white;
}
</style>
<svg width="1500" height="1000"></svg>
</svg>
<br>
<button type="button" id="button1" onclick="showGraph('normal')">Military Expenditure Normal Scale</button>
<button type="button" id="button2" onclick="showGraph('log')">Military Expenditure Log Scale</button>
<script>

var buttonSelect; 

var svg = d3.select("svg"),
    margin = {top: 20, right: 20, bottom: 30, left: 60},
    width = +svg.attr("width") - margin.left - margin.right,
    height = +svg.attr("height") - margin.top - margin.bottom,
    g = svg.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var x0 = d3.scaleBand()
    .rangeRound([0, width])
    .paddingInner(0.1);

var x1 = d3.scaleBand()
    .padding(0.05);

var y = d3.scaleLinear()
    .rangeRound([height, 0]);

showNormal()
function showGraph(type){
	//console.log(value);
	buttonSelect = type;
	if(type == "normal"){
		showNormal();
	} else if (type == "log"){
		showLog();
	}
}
function showNormal(){
	var z = d3.scaleOrdinal().range(["#A0CBF8", "#8DC0F7", "#79B6F6", "#66ABF4", "#53A1F3", "#4096F2"]);
	d3.csv("DataExpend.csv", function(d, i, columns) {
	    for (var i = 1, n = columns.length; i < n; ++i) 
	    d[columns[i]] = +(d[columns[i]]);
	    console.log("this is d:")
	    console.log(d)
	    return d;
	  }, function(error, data) {
	    if (error) throw error;

	    var years = data.columns.slice(1);
	    console.log(years);

	    x0.domain(data.map(function(d) { 
	      return d.CountryExpend; 
	    }));
	    x1.domain(years).rangeRound([0, x0.bandwidth()]);
	    y.domain([0, d3.max(data, function(d) { 
	      return d3.max(years, function(years) { 
	        return d[years]; 
	      }); 
	    })]).nice();

	    g.append("g")
	      .selectAll("g")
	      .data(data)
	      .enter().append("g")
	        .attr("transform", function(d) { 
	          return "translate(" + x0(d.CountryExpend) + ",0)"; 
	        })
	      .selectAll("rect")
	      .data(function(d) { 
	        return years.map(function(years) { 
	          return {years: years, value: d[years]}; 
	          }); 
	        })
	      .enter().append("rect")
	        .attr("x", function(d) { 
	          return x1(d.years); 
	        })
	        .attr("y", function(d) { 
	          return y(d.value); 
	        })
	        .attr("width", x1.bandwidth())
	        .attr("height", function(d) { 
	          return height - y(d.value); 
	        })
	        .attr("fill", function(d) { 
	          return z(d.years); 
	        });

	    g.append("g")
	        .attr("class", "axis")
	        .attr("transform", "translate(0," + height + ")")
	        .call(d3.axisBottom(x0));

	    g.append("g")
	        .attr("class", "axis")
	        .call(d3.axisLeft(y).ticks(null, "s"))
	      .append("text")
	        .attr("x", 2)
	        .attr("y", y(y.ticks().pop()) + 0.5)
	        .attr("dy", "0.32em")
	        .attr("fill", "#000")
	        .attr("font-weight", "bold")
	        .attr("text-anchor", "start")
	        .attr("font-size", 20)
	        .text("Millitary Expenditure Based on GDP");

	    var legend = g.append("g")
	        .attr("font-family", "sans-serif")
	        .attr("font-size", 20)
	        .attr("text-anchor", "end")
	        .attr("transform", "translate(0, 10)")
	      .selectAll("g")
	      .data(years.slice().reverse())
	      .enter().append("g")
	        .attr("transform", function(d, i) { 
	          return "translate(0," + i * 50 + ")"; 
	        });

	    legend.append("rect")
	        .attr("x", width - 19)
	        .attr("width", 50)
	        .attr("height", 30)
	        .attr("fill", z);

	    legend.append("text")
	        .attr("x", width - 30)
	        .attr("y", 9.5)
	        .attr("dy", "0.32em")
	        .text(function(d) { 
	          return d; 
	        });
	     
	});
	svg.selectAll("rect")
        .remove()
        .exit();
    svg.selectAll(".axis")
    	.remove()
    	.exit();

}
function showLog(){
	var z = d3.scaleOrdinal().range(["#F6948D", "#F5827A", "#F47167", "#F25F54", "#F14D41", "#EF3B2E"]);
	d3.csv("DataExpend.csv", function(d, i, columns) {
	    for (var i = 1, n = columns.length; i < n; ++i) 
	    d[columns[i]] = +Math.log(d[columns[i]]);
	    console.log("this is d:")
	    console.log(d)
	    return d;
	  }, function(error, data) {
	    if (error) throw error;

	    var years = data.columns.slice(1);
	    var rects = svg.select(".rect")
	    console.log(years);

	    x0.domain(data.map(function(d) { 
	      return d.CountryExpend; 
	    }));
	    x1.domain(years).rangeRound([0, x0.bandwidth()]);
	    y.domain([0, d3.max(data, function(d) { 
	      return d3.max(years, function(years) { 
	        return d[years]; 
	      }); 
	    })]).nice();

	    rects.enter()
	    g.append("g")
	      .selectAll("g")
	      .data(data)
	      .enter().append("g")
	        .attr("transform", function(d) { 
	          return "translate(" + x0(d.CountryExpend) + ",0)"; 
	        })
	      .selectAll("rect")
	      .data(function(d) { 
	        return years.map(function(years) { 
	          return {years: years, value: d[years]}; 
	          }); 
	        })
	      .enter().append("rect")
	        .attr("x", function(d) { 
	          return x1(d.years); 
	        })
	        .attr("y", function(d) { 
	          return y(d.value); 
	        })
	        .attr("width", x1.bandwidth())
	        .attr("height", function(d) { 
	          return height - y(d.value); 
	        })
	        .attr("fill", function(d) { 
	          return z(d.years); 
	        });

	    g.append("g")
	        .attr("class", "axis")
	        .attr("transform", "translate(0," + height + ")")
	        .call(d3.axisBottom(x0));

	    g.append("g")
	        .attr("class", "axis")
	        .call(d3.axisLeft(y).ticks(null, "s"))
	      .append("text")
	        .attr("x", 2)
	        .attr("y", y(y.ticks().pop()) + 0.5)
	        .attr("dy", "0.32em")
	        .attr("fill", "#000")
	        .attr("font-weight", "bold")
	        .attr("text-anchor", "start")
	        .text("Millitary Expenditure Based on GDP");

	    var legend = g.append("g")
	        .attr("font-family", "sans-serif")
	        .attr("font-size", 20)
	        .attr("text-anchor", "end")
	        .attr("transform", "translate(0, 10)")
	      .selectAll("g")
	      .data(years.slice().reverse())
	      .enter().append("g")
	        .attr("transform", function(d, i) { 
	          return "translate(0," + i * 50 + ")"; 
	        });

	    legend.append("rect")
	        .attr("x", width - 19)
	        .attr("width", 50)
	        .attr("height", 30)
	        .attr("fill", z);

	    legend.append("text")
	        .attr("x", width - 30)
	        .attr("y", 9.5)
	        .attr("dy", "0.32em")
	        .text(function(d) { 
	          return d; 
	        });
	    
	});
	svg.selectAll("rect")
        .remove()
        .exit();
    svg.selectAll(".axis")
    	.remove()
    	.exit();
    svg.transition()
    	.duration(750);
}

</script>